import jlib from 'jingtum-lib';

import * as requestInfo from '../utils/jingtum/requestInfo.js';
import * as contract from '../utils/jingtum/contract.js';

import {chains} from '../utils/info.js';

const contractChain = chains[1];
const platformAddress = contractChain.account.a[5].address;
const platformSecret = contractChain.account.a[5].secret;

const abi = [{"constant":false,"inputs":[{"name":"client_address","type":"address"},{"name":"order_id","type":"string"},{"name":"match_result","type":"string"}],"name":"updateOneMatch","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"client_address","type":"address"},{"name":"order_id","type":"string"},{"name":"match_results","type":"string"}],"name":"updateMatches","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_addr","type":"address"}],"name":"addAdmin","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_addr","type":"address"}],"name":"addChecker","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"order_id","type":"string"},{"name":"order_info","type":"string"}],"name":"makeOrder","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"}];

const payload = '60806040526000339050806000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060018060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff0219169083151502179055506001600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550506112a1806101086000396000f3fe608060405234801561001057600080fd5b5060043610610073576000357c0100000000000000000000000000000000000000000000000000000000900480620aeeec146100785780636d55da3a1461009457806370480275146100b0578063916473ab146100cc578063dc4c9e95146100e8575b600080fd5b610092600480360361008d9190810190610fdb565b610104565b005b6100ae60048036036100a99190810190610fdb565b610383565b005b6100ca60048036036100c59190810190610fb2565b6105af565b005b6100e660048036036100e19190810190610fb2565b61064c565b005b61010260048036036100fd9190810190611064565b6106e9565b005b60011515600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161515141515610199576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610190906111f5565b60405180910390fd5b60606101f16101a787610889565b86868080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050610a9f565b90506003816040518082805190602001908083835b60208310151561022b5780518252602082019150602081019050602083039250610206565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff1615156102ad576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016102a4906111b5565b60405180910390fd5b6102fa83838080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050610c72565b1561037b576003816040518082805190602001908083835b6020831015156103375780518252602082019150602081019050602083039250610312565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060006101000a81549060ff02191690555b505050505050565b60011515600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900460ff161515141515610418576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161040f906111f5565b60405180910390fd5b606061047061042687610889565b86868080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050610a9f565b90506003816040518082805190602001908083835b6020831015156104aa5780518252602082019150602081019050602083039250610485565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff16151561052c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610523906111b5565b60405180910390fd5b6003816040518082805190602001908083835b602083101515610564578051825260208201915060208101905060208303925061053f565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060006101000a81549060ff0219169055505050505050565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610640576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610637906111d5565b60405180910390fd5b61064981610cba565b50565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156106dd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106d4906111d5565b60405180910390fd5b6106e681610d1e565b50565b60606107416106f733610889565b86868080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050610a9f565b90506003816040518082805190602001908083835b60208310151561077b5780518252602082019150602081019050602083039250610756565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060009054906101000a900460ff161515156107fe576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107f590611215565b60405180910390fd5b60016003826040518082805190602001908083835b6020831015156108385780518252602082019150602081019050602083039250610813565b6001836020036101000a038019825116818451168082178552505050505050905001915050908152602001604051809103902060006101000a81548160ff0219169083151502179055505050505050565b60608060286040519080825280601f01601f1916602001820160405280156108c05781602001600182028038833980820191505090505b50905060008090505b6014811015610a955760008160130360080260020a8573ffffffffffffffffffffffffffffffffffffffff168115156108fe57fe5b047f010000000000000000000000000000000000000000000000000000000000000002905060006010827f0100000000000000000000000000000000000000000000000000000000000000900460ff1681151561095757fe5b047f01000000000000000000000000000000000000000000000000000000000000000290506000817f01000000000000000000000000000000000000000000000000000000000000009004601002837f01000000000000000000000000000000000000000000000000000000000000009004037f01000000000000000000000000000000000000000000000000000000000000000290506109f782610d78565b8585600202815181101515610a0857fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350610a4181610d78565b8560018660020201815181101515610a5557fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a90535050505080806001019150506108c9565b5080915050919050565b6060808390506060839050606081518351016040519080825280601f01601f191660200182016040528015610ae35781602001600182028038833980820191505090505b5090506060819050600080905060008090505b8551811015610ba9578581815181101515610b0d57fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f0100000000000000000000000000000000000000000000000000000000000000028383806001019450815181101515610b6c57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080600101915050610af6565b5060008090505b8451811015610c63578481815181101515610bc757fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f0100000000000000000000000000000000000000000000000000000000000000028383806001019450815181101515610c2657fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a9053508080600101915050610bb0565b50829550505050505092915050565b6000610cb36040805190810160405280600381526020017f454f46000000000000000000000000000000000000000000000000000000000081525083610e4a565b9050919050565b6001600260008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff021916908315150217905550610d1b81610d1e565b50565b60018060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548160ff02191690831515021790555050565b6000600a827f0100000000000000000000000000000000000000000000000000000000000000900460ff161015610df9576030827f01000000000000000000000000000000000000000000000000000000000000009004017f0100000000000000000000000000000000000000000000000000000000000000029050610e45565b6057827f01000000000000000000000000000000000000000000000000000000000000009004017f01000000000000000000000000000000000000000000000000000000000000000290505b919050565b600081518351141515610e605760009050610f4c565b816040516020018082805190602001908083835b602083101515610e995780518252602082019150602081019050602083039250610e74565b6001836020036101000a03801982511681845116808217855250505050505090500191505060405160208183030381529060405280519060200120836040516020018082805190602001908083835b602083101515610f0d5780518252602082019150602081019050602083039250610ee8565b6001836020036101000a038019825116818451168082178552505050505050905001915050604051602081830303815290604052805190602001201490505b92915050565b6000610f5e8235611255565b905092915050565b60008083601f8401121515610f7a57600080fd5b8235905067ffffffffffffffff811115610f9357600080fd5b602083019150836001820283011115610fab57600080fd5b9250929050565b600060208284031215610fc457600080fd5b6000610fd284828501610f52565b91505092915050565b600080600080600060608688031215610ff357600080fd5b600061100188828901610f52565b955050602086013567ffffffffffffffff81111561101e57600080fd5b61102a88828901610f66565b9450945050604086013567ffffffffffffffff81111561104957600080fd5b61105588828901610f66565b92509250509295509295909350565b6000806000806040858703121561107a57600080fd5b600085013567ffffffffffffffff81111561109457600080fd5b6110a087828801610f66565b9450945050602085013567ffffffffffffffff8111156110bf57600080fd5b6110cb87828801610f66565b925092505092959194509250565b6000601582527f4f7264657220646f6573206e6f742065786973742100000000000000000000006020830152604082019050919050565b6000602082527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e65726020830152604082019050919050565b6000601782527f43616c6c6572206973206e6f74207468652061646d696e0000000000000000006020830152604082019050919050565b6000601982527f4f726465722068617320616c72656164792065786973747321000000000000006020830152604082019050919050565b600060208201905081810360008301526111ce816110d9565b9050919050565b600060208201905081810360008301526111ee81611110565b9050919050565b6000602082019050818103600083015261120e81611147565b9050919050565b6000602082019050818103600083015261122e8161117e565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061126082611235565b905091905056fea265627a7a72305820ad5a1d73649495cf24dc096b660e7c4c1a5f96e77b630bbcc9a93c66140dd1d76c6578706572696d656e74616cf50037';

const Remote = jlib.Remote;
const contractRemote = new Remote({server: contractChain.server[0], local_sign: true});

contractRemote.connect(async function(err, res) {

    if(err) {
        return console.log('err: ', err);
    }
    else if(res) {
        console.log('connect: ', res);
    }

    let seq = (await requestInfo.requestAccountInfo(platformAddress, contractRemote, false)).account_data.Sequence;

    await contract.initContract(platformAddress, platformSecret, contractRemote, seq++, abi, payload, true);

})


// import jlib from 'jingtum-lib';
// var Remote = jlib.Remote;
// var remote = new Remote({server: 'ws://39.102.92.229:6030', local_sign:true});
// remote.connect(function (err, result) {
//     if (err) {
//         return console.log('err:', err);
//     }
//      var v = {
//         address: 'jHb9CJAWyB4jr91VRWn96DkukG4bwdtyTh',
//         secret: 'snoPBjXtMeMyMHUVTgbuqAfg1SUTb'
// };
//     const abi = [
//         {
//             "constant": true,
//             "inputs": [],
//             "name": "name",
//             "outputs": [
//                 {
//                     "name": "",
//                     "type": "string"
//                 }
//             ],
//             "payable": false,
//             "stateMutability": "view",
//             "type": "function"
//         },
//         {
//             "constant": true,
//             "inputs": [],
//             "name": "totalSupply",
//             "outputs": [
//                 {
//                     "name": "",
//                     "type": "uint256"
//                 }
//             ],
//             "payable": false,
//             "stateMutability": "view",
//             "type": "function"
//         },
//         {
//             "constant": true,
//             "inputs": [],
//             "name": "decimals",
//             "outputs": [
//                 {
//                     "name": "",
//                     "type": "uint8"
//                 }
//             ],
//             "payable": false,
//             "stateMutability": "view",
//             "type": "function"
//         },
//         {
//             "constant": true,
//             "inputs": [
//                 {
//                     "name": "",
//                     "type": "address"
//                 }
//             ],
//             "name": "balanceOf",
//             "outputs": [
//                 {
//                     "name": "",
//                     "type": "uint256"
//                 }
//             ],
//             "payable": false,
//             "stateMutability": "view",
//             "type": "function"
//         },
//         {
//             "constant": true,
//             "inputs": [],
//             "name": "symbol",
//             "outputs": [
//                 {
//                     "name": "",
//                     "type": "string"
//                 }
//             ],
//             "payable": false,
//             "stateMutability": "view",
//             "type": "function"
//         },
//         {
//             "constant": false,
//             "inputs": [
//                 {
//                     "name": "_to",
//                     "type": "address"
//                 },
//                 {
//                     "name": "_value",
//                     "type": "uint256"
//                 }
//             ],
//             "name": "transfer",
//             "outputs": [],
//             "payable": false,
//             "stateMutability": "nonpayable",
//             "type": "function"
//         },
//         {
//             "constant": true,
//             "inputs": [
//                 {
//                     "name": "",
//                     "type": "address"
//                 },
//                 {
//                     "name": "",
//                     "type": "address"
//                 }
//             ],
//             "name": "allowance",
//             "outputs": [
//                 {
//                     "name": "",
//                     "type": "uint256"
//                 }
//             ],
//             "payable": false,
//             "stateMutability": "view",
//             "type": "function"
//         },
//         {
//             "inputs": [
//                 {
//                     "name": "initialSupply",
//                     "type": "uint256"
//                 },
//                 {
//                     "name": "tokenName",
//                     "type": "string"
//                 },
//                 {
//                     "name": "tokenSymbol",
//                     "type": "string"
//                 }
//             ],
//             "payable": false,
//             "stateMutability": "nonpayable",
//             "type": "constructor"
//         },
//         {
//             "payable": false,
//             "stateMutability": "nonpayable",
//             "type": "fallback"
//         }
//     ];
// var tx = remote.initContract({
// 	 account: v.address, 
//     amount: 10,
//     payload: '60606040526012600260006101000a81548160ff021916908360ff160217905550341561002b57600080fd5b60405161092738038061092783398101604052808051906020019091908051820191906020018051820191905050600260009054906101000a900460ff1660ff16600a0a8302600381905550600354600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555081600090805190602001906100d39291906100f3565b5080600190805190602001906100ea9291906100f3565b50505050610198565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061013457805160ff1916838001178555610162565b82800160010185558215610162579182015b82811115610161578251825591602001919060010190610146565b5b50905061016f9190610173565b5090565b61019591905b80821115610191576000816000905550600101610179565b5090565b90565b610780806101a76000396000f300606060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306fdde031461009357806318160ddd14610121578063313ce5671461014a57806370a082311461017957806395d89b41146101c6578063a9059cbb14610254578063dd62ed3e14610296575b341561008e57600080fd5b600080fd5b341561009e57600080fd5b6100a6610302565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100e65780820151818401526020810190506100cb565b50505050905090810190601f1680156101135780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561012c57600080fd5b6101346103a0565b6040518082815260200191505060405180910390f35b341561015557600080fd5b61015d6103a6565b604051808260ff1660ff16815260200191505060405180910390f35b341561018457600080fd5b6101b0600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506103b9565b6040518082815260200191505060405180910390f35b34156101d157600080fd5b6101d96103d1565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102195780820151818401526020810190506101fe565b50505050905090810190601f1680156102465780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561025f57600080fd5b610294600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803590602001909190505061046f565b005b34156102a157600080fd5b6102ec600480803573ffffffffffffffffffffffffffffffffffffffff1690602001909190803573ffffffffffffffffffffffffffffffffffffffff1690602001909190505061047e565b6040518082815260200191505060405180910390f35b60008054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156103985780601f1061036d57610100808354040283529160200191610398565b820191906000526020600020905b81548152906001019060200180831161037b57829003601f168201915b505050505081565b60035481565b600260009054906101000a900460ff1681565b60046020528060005260406000206000915090505481565b60018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156104675780601f1061043c57610100808354040283529160200191610467565b820191906000526020600020905b81548152906001019060200180831161044a57829003601f168201915b505050505081565b61047a3383836104a3565b5050565b6005602052816000526040600020602052806000526040600020600091509150505481565b6000808373ffffffffffffffffffffffffffffffffffffffff16141515156104ca57600080fd5b81600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020541015151561051857600080fd5b600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205482600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054011115156105a657600080fd5b600460008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205401905081600460008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254039250508190555081600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000828254019250508190555080600460008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054600460008773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020540114151561074e57fe5b505050505600a165627a7a72305820b2665df0d8d8522803a19ac6bc98ff010121e11c16d0342eaced01d94100ce180029',
//    abi: abi,
//    params:[2000, 'TestCurrency', 'TEST1']
// });
//     tx.setSecret(v.secret);
//     tx.submit(function (err, result) {
//         if (err) {
//             console.log('err:', err);
//         }
//         else if (result) {
//             console.log('res:', result);
//         }
//     });
// });
